{% extends "base.html" %}
{% block title %}Shopping List â€” Meal Planner{% endblock %}
{% block content %}

<div style="max-width:700px">

  <form hx-post="/shopping/generate"
        hx-target="#shopping-results"
        hx-swap="innerHTML">

    <div class="toolbar" style="flex-wrap:wrap;gap:.5rem;margin-bottom:.75rem">
      <div class="form-group" style="margin:0;flex:1;min-width:140px">
        <label>From</label>
        <input type="date" name="start_date" id="start_date" value="{{ start_default }}">
      </div>
      <div class="form-group" style="margin:0;flex:1;min-width:140px">
        <label>To</label>
        <input type="date" name="end_date" id="end_date" value="{{ end_default }}">
      </div>
      <div class="form-group" style="margin:0;align-self:flex-end">
        <label>
          <input type="checkbox" name="use_pantry" checked> Subtract pantry items
        </label>
      </div>
      <div style="align-self:flex-end;display:flex;gap:.5rem">
        <button type="button" class="btn btn-secondary" onclick="setThisWeek()">This Week</button>
        <button type="submit" class="btn btn-primary">Generate</button>
        <span class="htmx-indicator"><span class="spinner"></span></span>
      </div>
    </div>

  </form>

  <div id="shopping-results"></div>

</div>

<script>
function setThisWeek() {
  const today = new Date();
  const dow = today.getDay();
  const diff = today.getDate() - dow + (dow === 0 ? -6 : 1);
  const monday = new Date(today.setDate(diff));
  const sunday = new Date(monday);
  sunday.setDate(monday.getDate() + 6);
  document.getElementById('start_date').value = monday.toISOString().slice(0, 10);
  document.getElementById('end_date').value   = sunday.toISOString().slice(0, 10);
}
</script>

{% endblock %}
